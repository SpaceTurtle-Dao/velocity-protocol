# VIP-06: Hub Discovery via Gossip Graph

## Summary

This proposal introduces a decentralized discovery mechanism for Velocity hubs using a gossip-based protocol. Each hub maintains a list of other hubs it "follows" and tracks hubs that "follow" it. This bidirectional graph forms the foundation of a self-propagating discovery network that enables resilient and censorship-resistant hub indexing.

## Motivation

Current discovery methods for decentralized nodes often rely on static registries or centralized directories, which introduce fragility and censorship risks. Velocity's design demands a dynamic, decentralized discovery layer. By leveraging a gossip protocol and social-graph-like following behavior, we can enable hubs to discover each other organically, just like people discover others in social networks.

## Specification

### Hub Relationships

* Each hub maintains two lists:

  * **Following**: A list of hubs it actively queries and trusts.
  * **Followers**: A list of hubs that have announced themselves to this hub.

### Reactive Gossip Mechanism

* Hubs do **not** gossip on a timer.
* Instead, gossip is triggered **when a hub receives a message from a hub it follows** (e.g., a profile update, post, or sealed message).
* This ties gossip to real network activity, amplifying relevant and recent connections.

### Gossip Flow

1. **Hub A** receives a message from **Hub B**, which it follows.
2. **Hub A** sends a **GOSSIP** message to its followers, saying:

   * "I just received a message from Hub B. Hereâ€™s who B follows."
3. This ripple continues as Hub A's followers receive and may forward B's info.

### Gossip Message Structure (ANS-104)

```json
{
  "kind": 1000,
  "tags": [
    ["hub", "true"],
    ["received-from", "hubB"],
    ["following", "hub1"],
    ["following", "hub2"],
    ["meta", "type:chat"],
    ["meta", "uptime:99.9"]
  ],
  "data": "...",
  "signature": "..."
}
```

### Query Routing

* When searching for a hub or content, a process first checks its local hub graph.
* If unresolved, it forwards the query to followed hubs.
* TTL or hop limit prevents infinite loops.
* Responses may be cached to improve performance.

## Benefits

* **Message-Driven Discovery**: Only active and relevant hubs propagate.
* **Fully Decentralized**: No need for centralized registries.
* **Resilient**: As long as some part of the graph is reachable, discovery continues.
* **Composable**: Tagging and metadata support search by hub type or location.
* **Sybil-Resistant Extensions**: Can incorporate stake-based trust or mutual-follow scoring.

## Considerations

* **Gossip Trigger Frequency**: Limited to when meaningful messages are received.
* **Data Volume**: TTL and tag-based pruning help control message size.
* **Security**: Only signed GOSSIP messages are accepted; hubs may choose to ignore unverified or spammy messages.

## Future Work

* Define reputation scoring mechanisms.
* Explore incentivized discovery relays.
* Integrate with sealed message routing protocols.

## License

Public domain under the terms of the Velocity Protocol.
